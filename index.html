<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ê·¹íš¨ìœ¨ ë ˆì‹œí”¼ - ìš”ë¦¬ & ì¥ë³´ê¸°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Pretendard í°íŠ¸ ì ìš© -->
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <style>
        /* ê¸°ë³¸ ì„¤ì • */
        body {
            background-color: #f3f4f6; /* ë°°ê²½ ë°ì€ íšŒìƒ‰ */
            color: #111;
            font-family: "Pretendard Variable", Pretendard, -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
            -webkit-font-smoothing: antialiased;
            overflow: hidden; /* ì•± ì»¨í…Œì´ë„ˆ ì™¸ ìŠ¤í¬ë¡¤ ë°©ì§€ */
        }

        /* ì•„ì´í° ë…¸ì¹˜ ëŒ€ì‘ ì•ˆì „ ì˜ì—­ */
        .safe-top { padding-top: env(safe-area-inset-top); }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }

        /* ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¸°ê¸° */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

        /* ì²´í¬ë°•ìŠ¤ ì»¤ìŠ¤í…€ */
        .custom-checkbox:checked {
            background-color: #f59e0b; /* amber-500 */
            border-color: #f59e0b;
            background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3e%3c/svg%3e");
        }

        /* ìœ íŠœë¸Œ ë˜í¼: 9:16 ë¹„ìœ¨ ìœ ì§€í•˜ë©° í™”ë©´ ìƒë‹¨ ì ìœ  */
        .video-wrapper {
            position: relative;
            width: 100%;
            height: 55vh; /* í™”ë©´ì˜ 55% ì°¨ì§€ */
            background: #000;
            overflow: hidden;
        }
        .video-iframe {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            transform: translate(-50%, -50%) scale(1.02); /* ì•½ê°„ í™•ëŒ€í•´ í…Œë‘ë¦¬ ì œê±° */
            border: none;
        }

        /* í•˜ë‹¨ ì»¨í…ì¸  ì˜ì—­ (ë‘¥ê·¼ ëª¨ì„œë¦¬) */
        .content-sheet {
            margin-top: -20px; /* ë¹„ë””ì˜¤ ìœ„ë¡œ ì‚´ì§ ì˜¬ë¼ì˜¤ê²Œ */
            border-top-left-radius: 24px;
            border-top-right-radius: 24px;
            background: white;
            position: relative;
            z-index: 10;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.05);
            height: 45vh; /* ë‚˜ë¨¸ì§€ ì˜ì—­ */
            display: flex;
            flex-direction: column;
        }

        /* Toast ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes slide-up {
            from { transform: translate(-50%, 20px); opacity: 0; }
            to { transform: translate(-50%, 0); opacity: 1; }
        }
        .toast { animation: slide-up 0.3s ease-out forwards; }
        
        /* íƒ­ë°” í™œì„±í™” íš¨ê³¼ */
        .tab-active { color: #111; font-weight: 600; }
        .tab-inactive { color: #9ca3af; }
    </style>
</head>
<body class="h-screen w-full flex justify-center bg-gray-100">

    <!-- ëª¨ë°”ì¼ ì•± ì»¨í…Œì´ë„ˆ -->
    <div id="app-container" class="relative w-full h-full max-w-md bg-white shadow-xl overflow-hidden flex flex-col">
        
        <!-- 1. ìƒë‹¨ í—¤ë” (ê³ ì •) -->
        <header class="absolute top-0 left-0 w-full z-30 px-4 py-3 flex justify-between items-center bg-gradient-to-b from-black/60 to-transparent safe-top">
            <div class="text-white font-bold text-lg flex items-center gap-2 drop-shadow-md">
                <i class="fa-solid fa-utensils text-amber-400"></i> ê·¹íš¨ìœ¨ ë ˆì‹œí”¼
            </div>
            <div class="flex gap-3">
                <button class="text-white drop-shadow-md"><i class="fa-solid fa-magnifying-glass"></i></button>
                <button onclick="app.toggleCartView()" class="relative text-white drop-shadow-md">
                    <i class="fa-solid fa-basket-shopping text-xl"></i>
                    <span id="header-cart-badge" class="absolute -top-1 -right-1 bg-red-500 text-white text-[10px] font-bold w-4 h-4 rounded-full flex items-center justify-center hidden">0</span>
                </button>
            </div>
        </header>

        <!-- 2. ë©”ì¸ ë·° (í™ˆ) -->
        <div id="view-home" class="flex-1 flex flex-col h-full relative">
            
            <!-- ì˜ìƒ ì˜ì—­ -->
            <div class="video-wrapper">
                <!-- ìœ íŠœë¸Œ ì‡¼ì¸  (ìë™ì¬ìƒ, ë®¤íŠ¸) -->
                <iframe class="video-iframe" 
                    src="https://www.youtube.com/embed/cN06rKfU3HY?autoplay=1&mute=1&controls=0&loop=1&playlist=cN06rKfU3HY&playsinline=1&rel=0&modestbranding=1" 
                    title="Recipe Video"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture">
                </iframe>
                <!-- ì˜ìƒ ìœ„ ê·¸ë¼ë°ì´ì…˜ (í…ìŠ¤íŠ¸ ê°€ë…ì„±ìš©) -->
                <div class="absolute inset-0 pointer-events-none bg-gradient-to-t from-black/40 via-transparent to-transparent"></div>
                
                <!-- ì˜ìƒ ë‚´ë¶€ ì •ë³´ (íƒ€ì´í‹€) -->
                <div class="absolute bottom-8 left-0 w-full px-5 pb-2 text-white pointer-events-none z-0">
                   <span class="bg-amber-500 text-white text-[10px] font-bold px-2 py-0.5 rounded mb-1 inline-block shadow-sm">ë‚œì´ë„ í•˜</span>
                   <h1 class="text-2xl font-bold leading-tight drop-shadow-lg">ì‹¤íŒ¨ ì—†ëŠ” ì†Œê³ ê¸° ì¹´ë ˆ</h1>
                   <p class="text-sm opacity-90 drop-shadow-md mt-1">ì¬ë£Œ 4ê°œë©´ ë! 1ë¶„ ë§Œì— ì¥ë³´ê¸° ì™„ë£Œ.</p>
                </div>
            </div>

            <!-- í•˜ë‹¨ ìƒì„¸ ì •ë³´ & ì¬ë£Œ ë¦¬ìŠ¤íŠ¸ -->
            <div class="content-sheet">
                <!-- í•¸ë“¤ë°” -->
                <div class="w-full flex justify-center pt-3 pb-1">
                    <div class="w-10 h-1 bg-gray-200 rounded-full"></div>
                </div>

                <div class="flex-1 overflow-y-auto px-5 pb-24 scrollbar-hide">
                    <!-- ì„¹ì…˜ í—¤ë” -->
                    <div class="flex justify-between items-end mb-4 mt-2 border-b border-gray-100 pb-3">
                        <div>
                            <h2 class="text-lg font-bold text-gray-900">í•„ìš”í•œ ì¬ë£Œ <span class="text-amber-500 text-sm font-normal ml-1" id="ingredient-count">4ê°œ</span></h2>
                            <p class="text-xs text-gray-400 mt-0.5">ì²´í¬í•˜ë©´ ì¥ë°”êµ¬ë‹ˆì— ë‹´ê¹ë‹ˆë‹¤</p>
                        </div>
                        <button onclick="app.toggleAllIngredients()" class="text-xs font-bold bg-gray-100 text-gray-600 px-3 py-1.5 rounded-lg hover:bg-gray-200 transition">
                            ì „ì²´ ì„ íƒ
                        </button>
                    </div>

                    <!-- ì¬ë£Œ ë¦¬ìŠ¤íŠ¸ (ì—¬ê¸°ì— ë Œë”ë§) -->
                    <div id="ingredient-list" class="space-y-3">
                        <!-- JSë¡œ ì±„ì›Œì§ -->
                    </div>
                    
                    <!-- ì—¬ë°± -->
                    <div class="h-10"></div>
                </div>

                <!-- í•˜ë‹¨ ê³ ì • 'êµ¬ë§¤í•˜ê¸°' ë²„íŠ¼ -->
                <div class="absolute bottom-0 left-0 w-full bg-white border-t border-gray-100 p-4 pb-6 shadow-[0_-4px_20px_rgba(0,0,0,0.05)] safe-bottom">
                    <button onclick="app.buySelected()" id="main-buy-btn" class="w-full bg-amber-400 hover:bg-amber-500 text-black font-bold text-lg py-3.5 rounded-xl shadow-lg shadow-amber-400/20 transition transform active:scale-95 flex justify-between items-center px-6">
                        <span>0ì› êµ¬ë§¤í•˜ê¸°</span>
                        <span class="text-sm font-normal opacity-80">ì¿ íŒ¡ ë¡œì¼“ë°°ì†¡ <i class="fa-solid fa-chevron-right text-xs ml-1"></i></span>
                    </button>
                </div>
            </div>
        </div>

        <!-- 3. ì¥ë°”êµ¬ë‹ˆ ë·° (ì˜¤ë²„ë ˆì´) -->
        <div id="view-cart" class="absolute inset-0 bg-white z-40 translate-y-full transition-transform duration-300 flex flex-col">
            <header class="px-4 py-3 border-b border-gray-100 flex justify-between items-center safe-top bg-white">
                <h2 class="font-bold text-lg">ì¥ë°”êµ¬ë‹ˆ</h2>
                <button onclick="app.toggleCartView()" class="p-2 text-gray-500 hover:bg-gray-100 rounded-full">
                    <i class="fa-solid fa-xmark text-xl"></i>
                </button>
            </header>
            
            <div id="cart-items-container" class="flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50">
                <!-- ì¹´íŠ¸ ì•„ì´í…œ -->
            </div>

            <div class="p-4 border-t border-gray-100 bg-white safe-bottom pb-6">
                <div class="flex justify-between mb-4">
                    <span class="text-gray-500">ì´ ê²°ì œ ì˜ˆìƒ ê¸ˆì•¡</span>
                    <span id="cart-total-price" class="font-bold text-xl text-gray-900">0ì›</span>
                </div>
                <button onclick="app.checkout()" class="w-full bg-gray-900 text-white font-bold py-3.5 rounded-xl hover:bg-black transition">
                    ëª¨ë‘ êµ¬ë§¤í•˜ëŸ¬ ê°€ê¸°
                </button>
            </div>
        </div>

        <!-- í† ìŠ¤íŠ¸ ë©”ì‹œì§€ -->
        <div id="toast-container" class="absolute bottom-24 left-1/2 z-50 w-full pointer-events-none"></div>

    </div>

    <script>
        // --- ë°ì´í„° ---
        const RECIPE_DATA = {
            id: 1,
            title: "ì‹¤íŒ¨ ì—†ëŠ” ì†Œê³ ê¸° ì¹´ë ˆ",
            ingredients: [
                { id: 'ing_1', name: "ì–‘íŒŒ", desc: "í•„ìˆ˜ ì¬ë£Œ", price: 3500, link: "https://link.coupang.com/a/c5CXMg" },
                { id: 'ing_2', name: "ë‹¹ê·¼", desc: "2ê°œì…", price: 2800, link: "https://link.coupang.com/a/c5CYAb" },
                { id: 'ing_3', name: "ì†Œê³ ê¸° êµ­ê±°ë¦¬", desc: "1íŒ© (300g)", price: 12900, link: "https://link.coupang.com/a/c5CZbA" },
                { id: 'ing_4', name: "ê³ í˜•ì¹´ë ˆ", desc: "ì•½ê°„ ë§¤ìš´ë§›", price: 4500, link: "https://link.coupang.com/a/c5CZJz" }
            ]
        };

        class RecipeApp {
            constructor() {
                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì¥ë°”êµ¬ë‹ˆ ë¶ˆëŸ¬ì˜¤ê¸° (ID ê¸°ì¤€)
                this.cartIds = JSON.parse(localStorage.getItem('myCartIds')) || [];
                this.init();
            }

            init() {
                this.renderIngredients();
                this.updateUI();
            }

            // ì¬ë£Œ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§ (ë©”ì¸ í™”ë©´)
            renderIngredients() {
                const container = document.getElementById('ingredient-list');
                container.innerHTML = RECIPE_DATA.ingredients.map(ing => {
                    const isChecked = this.cartIds.includes(ing.id);
                    return `
                    <div class="bg-white border border-gray-100 rounded-xl p-3 flex items-center justify-between shadow-sm hover:border-amber-200 transition cursor-pointer" onclick="app.toggleItem('${ing.id}')">
                        <div class="flex items-center gap-3">
                            <div class="relative">
                                <input type="checkbox" id="chk-${ing.id}" ${isChecked ? 'checked' : ''} 
                                    class="custom-checkbox w-5 h-5 rounded border-gray-300 text-amber-500 focus:ring-amber-500 cursor-pointer pointer-events-none">
                            </div>
                            <div>
                                <p class="font-bold text-gray-800 text-sm leading-none mb-1">${ing.name}</p>
                                <p class="text-xs text-gray-500">${ing.desc}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="font-bold text-sm text-gray-900">${ing.price.toLocaleString()}ì›</p>
                            <button onclick="event.stopPropagation(); window.open('${ing.link}')" class="text-[10px] text-gray-400 underline decoration-gray-300">ìƒì„¸ë³´ê¸°</button>
                        </div>
                    </div>
                    `;
                }).join('');
            }

            // ì•„ì´í…œ í† ê¸€ (ì²´í¬ë°•ìŠ¤)
            toggleItem(id) {
                if (this.cartIds.includes(id)) {
                    this.cartIds = this.cartIds.filter(itemId => itemId !== id);
                } else {
                    this.cartIds.push(id);
                    this.showToast("ì¥ë°”êµ¬ë‹ˆì— ë‹´ê²¼ìŠµë‹ˆë‹¤");
                }
                this.save();
                this.updateUI();
            }

            // ì „ì²´ ì„ íƒ/í•´ì œ
            toggleAllIngredients() {
                const allIds = RECIPE_DATA.ingredients.map(i => i.id);
                const isAllSelected = allIds.every(id => this.cartIds.includes(id));

                if (isAllSelected) {
                    // í˜„ì¬ ë ˆì‹œí”¼ì˜ ì¬ë£Œë§Œ í•´ì œ (ë‹¤ë¥¸ ë ˆì‹œí”¼ ì¬ë£Œ ìœ ì§€í•˜ë ¤ë©´ ë¡œì§ ìˆ˜ì • í•„ìš”í•˜ì§€ë§Œ ì§€ê¸ˆì€ ë‹¨ì¼ ë ˆì‹œí”¼)
                    this.cartIds = []; 
                    this.showToast("ì „ì²´ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤");
                } else {
                    this.cartIds = [...allIds];
                    this.showToast("ëª¨ë“  ì¬ë£Œê°€ ë‹´ê²¼ìŠµë‹ˆë‹¤");
                }
                this.save();
                this.updateUI();
            }

            // UI ì—…ë°ì´íŠ¸ (ë°°ì§€, ì´ì•¡, ë²„íŠ¼ í…ìŠ¤íŠ¸, ì²´í¬ë°•ìŠ¤ ìƒíƒœ)
            updateUI() {
                // 1. ë©”ì¸ ë¦¬ìŠ¤íŠ¸ ì²´í¬ë°•ìŠ¤ ë™ê¸°í™”
                RECIPE_DATA.ingredients.forEach(ing => {
                    const chk = document.getElementById(`chk-${ing.id}`);
                    if (chk) chk.checked = this.cartIds.includes(ing.id);
                });

                // 2. ê³„ì‚°
                let total = 0;
                let count = 0;
                RECIPE_DATA.ingredients.forEach(ing => {
                    if (this.cartIds.includes(ing.id)) {
                        total += ing.price;
                        count++;
                    }
                });

                // 3. ë©”ì¸ êµ¬ë§¤ ë²„íŠ¼ ì—…ë°ì´íŠ¸
                const btn = document.getElementById('main-buy-btn');
                if (count > 0) {
                    btn.querySelector('span:first-child').innerText = `${total.toLocaleString()}ì› êµ¬ë§¤í•˜ê¸° (${count}ê°œ)`;
                    btn.classList.remove('bg-gray-300', 'text-gray-500', 'pointer-events-none');
                    btn.classList.add('bg-amber-400', 'text-black');
                } else {
                    btn.querySelector('span:first-child').innerText = "ì¬ë£Œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”";
                    btn.classList.remove('bg-amber-400', 'text-black');
                    btn.classList.add('bg-gray-300', 'text-gray-500'); // ë¹„í™œì„± ìŠ¤íƒ€ì¼ì€ ì•„ë‹ˆì§€ë§Œ íšŒìƒ‰ ì²˜ë¦¬
                }

                // 4. í—¤ë” ë°°ì§€
                const badge = document.getElementById('header-cart-badge');
                badge.innerText = count;
                badge.classList.toggle('hidden', count === 0);
            }

            // ì¥ë°”êµ¬ë‹ˆ ë·° ì—´ê¸°/ë‹«ê¸° ë° ë Œë”ë§
            toggleCartView() {
                const view = document.getElementById('view-cart');
                const isOpen = !view.classList.contains('translate-y-full');
                
                if (!isOpen) {
                    // ì—´ë¦´ ë•Œ ë Œë”ë§
                    this.renderCartItems();
                    view.classList.remove('translate-y-full');
                } else {
                    view.classList.add('translate-y-full');
                }
            }

            renderCartItems() {
                const container = document.getElementById('cart-items-container');
                const selectedItems = RECIPE_DATA.ingredients.filter(i => this.cartIds.includes(i.id));
                
                let total = 0;
                
                if (selectedItems.length === 0) {
                    container.innerHTML = `
                        <div class="flex flex-col items-center justify-center h-64 text-gray-400">
                            <i class="fa-solid fa-basket-shopping text-4xl mb-2"></i>
                            <p>ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì—ˆìŠµë‹ˆë‹¤</p>
                        </div>`;
                } else {
                    container.innerHTML = selectedItems.map(ing => {
                        total += ing.price;
                        return `
                        <div class="bg-white p-3 rounded-lg shadow-sm border border-gray-100 flex justify-between items-center">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 bg-gray-100 rounded-md flex items-center justify-center text-xl">ğŸ¥•</div>
                                <div>
                                    <p class="font-bold text-sm">${ing.name}</p>
                                    <p class="text-xs text-gray-500">${ing.price.toLocaleString()}ì›</p>
                                </div>
                            </div>
                            <button onclick="app.toggleItem('${ing.id}'); app.renderCartItems()" class="text-gray-400 hover:text-red-500 p-2">
                                <i class="fa-solid fa-trash-can"></i>
                            </button>
                        </div>
                        `;
                    }).join('');
                }
                document.getElementById('cart-total-price').innerText = `${total.toLocaleString()}ì›`;
            }

            // êµ¬ë§¤í•˜ê¸° (ë§í¬ ì—´ê¸°)
            buySelected() {
                if (this.cartIds.length === 0) {
                    this.showToast("ì„ íƒëœ ì¬ë£Œê°€ ì—†ìŠµë‹ˆë‹¤.");
                    return;
                }
                this.checkout();
            }

            checkout() {
                const selectedItems = RECIPE_DATA.ingredients.filter(i => this.cartIds.includes(i.id));
                if (selectedItems.length === 0) return;

                if (confirm(`${selectedItems.length}ê°œì˜ ìƒí’ˆ êµ¬ë§¤ í˜ì´ì§€ë¥¼ ì—½ë‹ˆë‹¤.\n(íŒì—… ì°¨ë‹¨ì„ í•´ì œí•´ì£¼ì„¸ìš”)`)) {
                    selectedItems.forEach(item => window.open(item.link, '_blank'));
                }
            }

            save() {
                localStorage.setItem('myCartIds', JSON.stringify(this.cartIds));
            }

            showToast(msg) {
                const container = document.getElementById('toast-container');
                const el = document.createElement('div');
                el.className = 'toast bg-black/80 text-white text-xs font-medium px-4 py-2.5 rounded-full shadow-lg mb-2 mx-auto w-max flex items-center gap-2 backdrop-blur-sm';
                el.innerHTML = `<i class="fa-solid fa-check text-amber-400"></i> ${msg}`;
                container.appendChild(el);
                setTimeout(() => el.remove(), 2500);
            }
        }

        const app = new RecipeApp();
    </script>
</body>
</html>
